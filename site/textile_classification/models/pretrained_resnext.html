<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>ResNeXt - Home</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "ResNeXt";
        var mkdocs_page_input_path = "textile_classification\\models\\pretrained_resnext.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../index.html" class="icon icon-home"> Home
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Textile Classification</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../train.html">Train</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../test.html">Test</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../predict.html">Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Data_Setters</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../data_setters/create_csv_files.html">Create_CSV_Files</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../data_setters/data_set_creator.html">Data_Set_Creator</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Models</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="pretrained_densenet.html">DenseNet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="pretrained_efficientnet.html">EfficientNet</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="pretrained_resnext.html">ResNeXt</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../utils/data_set_visualization.html">Data_Set_Visualization</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../utils/metric_calculation_visualization.html">Metric_Calculation_Visualization</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../utils/miscellaneous.html">miscellaneous</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../utils/model_tracking.html">model_tracking</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Home</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Textile Classification &raquo;</li>
          <li>Models &raquo;</li>
      <li>ResNeXt</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/srahmatian/texture_classification/edit/master/docs/textile_classification/models/pretrained_resnext.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">


<a id="textile_classification.models.pretrained_resnext"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt" class="doc doc-heading">
        <code>PretrainedResNeXt</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>

  
      <p>This model is one of the famous model in image classification. 
And it is possilbe to use such a pretrained model from torchvision.models.
the checkpoint of pretrained model already donwloaded from https://download.pytorch.org/models/resnext50_32x4d-1a0047aa.pth
and it must be put in this directory: torch.hub.get_dir()/checkpoints
But this model was trained on another kind of classification with differen number of labels, so
we need to change its FC layer and fine tune the whole model.
You can find more details about it on https://arxiv.org/abs/1611.05431</p>


        <details class="quote">
          <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PretrainedResNeXt</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This model is one of the famous model in image classification. </span>
<span class="sd">    And it is possilbe to use such a pretrained model from torchvision.models.</span>
<span class="sd">    the checkpoint of pretrained model already donwloaded from https://download.pytorch.org/models/resnext50_32x4d-1a0047aa.pth</span>
<span class="sd">    and it must be put in this directory: torch.hub.get_dir()/checkpoints</span>
<span class="sd">    But this model was trained on another kind of classification with differen number of labels, so</span>
<span class="sd">    we need to change its FC layer and fine tune the whole model.</span>
<span class="sd">    You can find more details about it on https://arxiv.org/abs/1611.05431</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_in_fearues_of_fc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">new_out_features_of_fc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This models can not be used for different image sizes since</span>
<span class="sd">        the number of feature extarcted by cnn layers will change dependently.</span>
<span class="sd">        You also would need to use this model for different number of labels (out_feaures), so</span>
<span class="sd">        You would need to change the architecture of the FC layers based on your input image size and number of labels.</span>
<span class="sd">        For doing that you need to inspect the original architecture to find layers&#39; name, then</span>
<span class="sd">        you will know how to access to them for chaning or replacing.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_in_fearues_of_fc (Union[int, None], optional): If you pass None, it will not change.</span>
<span class="sd">            new_out_features_of_fc (Union[int, None], optional): If you pass None, it will not change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_original_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">new_in_fearues_of_fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">new_out_features_of_fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_fc_layer</span><span class="p">(</span><span class="n">new_in_fearues_of_fc</span><span class="p">,</span> <span class="n">new_out_features_of_fc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_original_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function take it look at HUB_DIR_PRETRAINED, </span>
<span class="sd">        and create the resnext50_32x4d model by load its pth file in that directory. </span>

<span class="sd">        Returns:</span>
<span class="sd">            nn.Module: the original pre-trained model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">HUB_DIR_PRETRAINED</span><span class="p">)</span>
        <span class="n">original_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">HUB_DIR_PRETRAINED</span><span class="p">,</span> <span class="s2">&quot;resnext50_32x4d&quot;</span><span class="p">,</span> 
                                        <span class="n">source</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;ResNeXt50_32X4D_Weights.DEFAULT&quot;</span><span class="p">)</span>

        <span class="c1"># Make sure to set gradients of all model parameters to zero</span>
        <span class="n">original_model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="c1"># Make all the layers unfrozen for fine tunning</span>
        <span class="n">original_model</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">original_model</span>

    <span class="k">def</span> <span class="nf">change_fc_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_in_featues</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_out_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        there is only one FC layer inside original model which is named fc.</span>
<span class="sd">        This function replace the fc of original model to make it compatibel for new input and output sizes.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_in_featues (int): num of input features for the FC layer</span>
<span class="sd">            new_out_features (int):number of classes (labels)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="n">new_in_featues</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="n">new_out_features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">new_fc</span>

    <span class="k">def</span> <span class="nf">find_num_feaures_extraced_by_cnn_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        by passing your input image to this function,</span>
<span class="sd">        you will find the number of features extracted by whole CNN layers before the fully connedted layer.</span>
<span class="sd">        The output of this function can be used for change the FC layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (torch.Tensor): is a tensor in shape of (batch_size, 3, height, width)</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the number of feautres extracted by whole CNN layers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">),</span> <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;the input of find_num_feaures_extraced_by_cnn_layers must have 4 dimenstions&quot;</span><span class="p">)</span>
        <span class="n">model_removed_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># note that index 0 retrun batch_size</span>
        <span class="n">num_feaures</span> <span class="o">=</span> <span class="n">model_removed_fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">num_feaures</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines how the model produce the output.</span>
<span class="sd">        Args:</span>
<span class="sd">            x (torch.Tensor): is a tensor in shape of (batch_size, 3, height, width)</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: is a tensor in shape of (batch_size, num_labels) which is (batch_size, 2) in our task</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">new_in_fearues_of_fc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_out_features_of_fc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This models can not be used for different image sizes since
the number of feature extarcted by cnn layers will change dependently.
You also would need to use this model for different number of labels (out_feaures), so
You would need to change the architecture of the FC layers based on your input image size and number of labels.
For doing that you need to inspect the original architecture to find layers' name, then
you will know how to access to them for chaning or replacing.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>new_in_fearues_of_fc</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, None]</code>
          </td>
          <td><p>If you pass None, it will not change.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>new_out_features_of_fc</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, None]</code>
          </td>
          <td><p>If you pass None, it will not change.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_in_fearues_of_fc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
             <span class="n">new_out_features_of_fc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This models can not be used for different image sizes since</span>
<span class="sd">    the number of feature extarcted by cnn layers will change dependently.</span>
<span class="sd">    You also would need to use this model for different number of labels (out_feaures), so</span>
<span class="sd">    You would need to change the architecture of the FC layers based on your input image size and number of labels.</span>
<span class="sd">    For doing that you need to inspect the original architecture to find layers&#39; name, then</span>
<span class="sd">    you will know how to access to them for chaning or replacing.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_in_fearues_of_fc (Union[int, None], optional): If you pass None, it will not change.</span>
<span class="sd">        new_out_features_of_fc (Union[int, None], optional): If you pass None, it will not change.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_original_model</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">new_in_fearues_of_fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">new_out_features_of_fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_fc_layer</span><span class="p">(</span><span class="n">new_in_fearues_of_fc</span><span class="p">,</span> <span class="n">new_out_features_of_fc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt.change_fc_layer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">change_fc_layer</span><span class="p">(</span><span class="n">new_in_featues</span><span class="p">,</span> <span class="n">new_out_features</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>there is only one FC layer inside original model which is named fc.
This function replace the fc of original model to make it compatibel for new input and output sizes.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>new_in_featues</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>num of input features for the FC layer</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>new_out_features</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of classes (labels)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">change_fc_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_in_featues</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_out_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    there is only one FC layer inside original model which is named fc.</span>
<span class="sd">    This function replace the fc of original model to make it compatibel for new input and output sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_in_featues (int): num of input features for the FC layer</span>
<span class="sd">        new_out_features (int):number of classes (labels)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="n">new_in_featues</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="n">new_out_features</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">new_fc</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt.find_num_feaures_extraced_by_cnn_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_num_feaures_extraced_by_cnn_layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>by passing your input image to this function,
you will find the number of features extracted by whole CNN layers before the fully connedted layer.
The output of this function can be used for change the FC layer.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>is a tensor in shape of (batch_size, 3, height, width)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the number of feautres extracted by whole CNN layers</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_num_feaures_extraced_by_cnn_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    by passing your input image to this function,</span>
<span class="sd">    you will find the number of features extracted by whole CNN layers before the fully connedted layer.</span>
<span class="sd">    The output of this function can be used for change the FC layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (torch.Tensor): is a tensor in shape of (batch_size, 3, height, width)</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: the number of feautres extracted by whole CNN layers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">),</span> <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
        <span class="s2">&quot;the input of find_num_feaures_extraced_by_cnn_layers must have 4 dimenstions&quot;</span><span class="p">)</span>
    <span class="n">model_removed_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># note that index 0 retrun batch_size</span>
    <span class="n">num_feaures</span> <span class="o">=</span> <span class="n">model_removed_fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">num_feaures</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This function determines how the model produce the output.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>is a tensor in shape of (batch_size, 3, height, width)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: is a tensor in shape of (batch_size, num_labels) which is (batch_size, 2) in our task</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function determines how the model produce the output.</span>
<span class="sd">    Args:</span>
<span class="sd">        x (torch.Tensor): is a tensor in shape of (batch_size, 3, height, width)</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor: is a tensor in shape of (batch_size, num_labels) which is (batch_size, 2) in our task</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="textile_classification.models.pretrained_resnext.PretrainedResNeXt.get_original_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_original_model</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This function take it look at HUB_DIR_PRETRAINED, 
and create the resnext50_32x4d model by load its pth file in that directory. </p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>nn.Module: the original pre-trained model</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>textile_classification\models\pretrained_resnext.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_original_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function take it look at HUB_DIR_PRETRAINED, </span>
<span class="sd">    and create the resnext50_32x4d model by load its pth file in that directory. </span>

<span class="sd">    Returns:</span>
<span class="sd">        nn.Module: the original pre-trained model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">HUB_DIR_PRETRAINED</span><span class="p">)</span>
    <span class="n">original_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">HUB_DIR_PRETRAINED</span><span class="p">,</span> <span class="s2">&quot;resnext50_32x4d&quot;</span><span class="p">,</span> 
                                    <span class="n">source</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;ResNeXt50_32X4D_Weights.DEFAULT&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure to set gradients of all model parameters to zero</span>
    <span class="n">original_model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="c1"># Make all the layers unfrozen for fine tunning</span>
    <span class="n">original_model</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">original_model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="pretrained_efficientnet.html" class="btn btn-neutral float-left" title="EfficientNet"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../utils/data_set_visualization.html" class="btn btn-neutral float-right" title="Data_Set_Visualization">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/srahmatian/texture_classification" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="pretrained_efficientnet.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../utils/data_set_visualization.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
